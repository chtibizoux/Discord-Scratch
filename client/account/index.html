<!DOCTYPE html>
<html lang="fr" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Discord Scratch</title>
        <link rel="shortcut icon" href="/assets/images/favicon.ico">
        <meta name="description" content="A web site to make discord bots with scratch.">
        <meta name="author" content="ClÃ©ment Songis">
        <meta name="application-name" content="Discord Scratch">
        <meta name="theme-color" content="#cce1fc">
        <meta name="color-scheme" content="only light">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="index">
        <meta name="keywords" content="discord,scratch,bot">
        <link rel="stylesheet" href="/css/style.css">
        <script src="https://kit.fontawesome.com/740353a2ba.js"></script>
        <script src="/socket.io/socket.io.js"></script>
    </head>
    <body>
        <header>
            <div>
                <button class="header-button logo-button" onclick="document.location.href = '#'"><img class="logo" src="/assets/images/logo.png" alt="Logo"></button>
                <button class="header-button" onclick="document.location.href = '/editor'">Editor</button>
                <button class="header-button" onclick="document.location.href = 'https://clementsongis.wordpress.com/'">Author WebSite</button>
                <button class="header-button" onclick="document.location.href = 'https://discord.gg/jwVzMKuNym'">Discord Serveur</button>
                <!-- <button class="header-button" onclick="document.location.href = '/extentions'">Extentions</button> -->
            </div>
            <div>
                <button class="header-button" id="logout-button" style="display: none;" onclick="logout()">Logout</button>
                <button class="header-button login-button" id="header-login-button" onclick="document.location.href = 'https://discord.com/api/oauth2/authorize?client_id=797107487689932842&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Fredirect%2F&response_type=code&scope=identify%20email'">Login</button>
            </div>
        </header>
        <div class="new-div">
            <button class="new-button" onclick="document.getElementById('create-div').style.display = 'block';">New Project</button>
        </div>
        <div id="create-div" style="display: none;">
            <h2>Create a project</h2>
            <label for="create-project-name">Name</label><br>
            <input type="text" name="create-project-name" placeholder="Untitled"><br>
            <button class="new-button" onclick="document.location.href = '/editor/?name=' + document.getElementsByName('create-project-name')[0].value;">Create</button>
            <button class="create-cancel-button" onclick="document.getElementById('create-div').style.display = 'none';">Cancel</button>
        </div>
        <section id="projects">
            <h2>Create a new project to start making cool discord bot !</h2>
            <img src="/assets/images/bot.svg" alt="Bot" style="padding-top: 50px;">
        </section>
        <div id="context-menu" style="display: none;">
            <button class="context-button" id="duplicate">Dupliquer</button>
            <button class="context-button" id="delete">Supprimer</button>
        </div>
        <script>
            var socket = io();
            for(var i = 0; i < decodeURIComponent(document.cookie).split(';').length; i++) {
                var c = decodeURIComponent(document.cookie).split(';')[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf("id=") == 0) {
                    socket.emit("cookie", c.substring(name.length, c.length).slice(3));
                }
            }
            socket.on('cookieSucces', function(username, tutorial, socketID){
                if (socketID === socket.id) {
                    document.getElementById("logout-button").style.display = "inline-block";
                    var buttons = document.getElementsByClassName("login-button");
                    for (var i = 0; i < buttons.length; i++) {
                        buttons[i].innerHTML = username;
                        buttons[i].setAttribute('onclick',"document.location.href = '/account'");
                    }
                }
            });
            function logout() {
                document.cookie = "id=;path=/";
                document.location.href = "/";
            }
            socket.emit("projects");
            socket.on('projects', function(projects, socketID){
                if (socketID === socket.id) {
                    var html = '<h2>Create a new project to start making cool discord bot !</h2><img src="/assets/images/bot.svg" alt="Bot" style="padding-top: 50px;">';
                    for (var projectName in projects) {
                        html += '<div class="project-button" projectName="' + projectName + '" onclick="document.location.href = \'/editor/?name=' + projectName + '\'"><div class="project-img"><img src="/assets/images/project.png" alt=""></div><div class="project-button-name">' + projectName + '</div><button class="project-delete-button" onclick="event.stopPropagation();socket.emit(\'deleteProject\', \'' + projectName + '\');"><img src="/assets/images/trash.svg" alt=""></button></div>';
                    }
                    if (html !== '<h2>Create a new project to start making cool discord bot !</h2><img src="/assets/images/bot.svg" alt="Bot" style="padding-top: 50px;">') {
                        document.getElementById("projects").style.display = "flex";
                    }else{
                        document.getElementById("projects").style.display = "block";
                    }
                    document.getElementById("projects").innerHTML = html;
                    for (i = 0; i < document.getElementsByClassName("project-button").length; i++) {
                        const button = document.getElementsByClassName("project-button")[i];
                        button.addEventListener('contextmenu', e => {
                            e.preventDefault();
                            contextProjectName = button.getAttribute("projectName");
                            menu.style.display = "block";
                            if ((window.innerWidth - e.pageX) < (menu.offsetWidth + 4)) {
                                menu.style.left = window.innerWidth - (menu.offsetWidth + 4) + "px";
                            } else {
                                menu.style.left = e.pageX + "px";
                            }
                            if ((window.innerHeight - e.pageY) < (menu.offsetHeight + 4)) {
                                menu.style.top = window.innerHeight - (menu.offsetHeight + 4) + "px";
                            } else {
                                menu.style.top = e.pageY + "px";
                            }
                            return false;
                        });
                    }
                }
            });
            var contextProjectName = "";
            var menu = document.getElementById('context-menu');
            window.addEventListener("click", e => {
                if (menu.style.display === "block") menu.style.display = "none";
            });
            document.getElementById("duplicate").addEventListener("click", function () {
                socket.emit("duplicateProject", contextProjectName);
            });
            document.getElementById("delete").addEventListener("click", function () {
                socket.emit("deleteProject", contextProjectName);
            });
        </script>
    </body>
</html>
