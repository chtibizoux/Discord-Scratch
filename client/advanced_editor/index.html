<!DOCTYPE html>
<html lang="fr" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Discord Scratch</title>
        <link rel="shortcut icon" href="/assets/images/favicon.ico">
        <meta name="description" content="A web site to make discord bots with scratch.">
        <meta name="author" content="ClÃ©ment Songis">
        <meta name="application-name" content="Discord Scratch">
        <meta name="theme-color" content="#cce1fc">
        <meta name="color-scheme" content="only light">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="index">
        <meta name="keywords" content="discord,scratch,bot">
        <link rel="stylesheet" href="/css/editor.css">
        <link rel="stylesheet" href="/css/prism.css"></link>
        <script src="/js/prism.js"></script>
        <script src="https://kit.fontawesome.com/740353a2ba.js"></script>
        <script src="/js/advanced_blockly_compressed_vertical.js"></script>
        <script src="/js/advanced_blocks_compressed.js"></script>
        <script src="/js/advanced_blocks_compressed_vertical.js"></script>
        <script src="/js/advanced_scratch_msgs.js"></script>
        <script src="/js/javascript_compressed.js"></script>
        <script src="/js/advanced_blocks_javascript.js"></script>
        <script src="/socket.io/socket.io.js"></script>
    </head>
    <body>
        <header>
            <div>
                <button class="header-button logo-button" onclick="document.location.href = '/'"><img class="logo" src="/assets/images/logo.png" alt="Logo"></button>
                <button class="header-button" onclick="document.location.href = '/wiki'">Wiki</button>
                <button class="header-button" onclick="document.getElementById('file-menu').classList.toggle('visible');document.getElementById('edit-menu').classList.remove('visible');">File</button>
                <div class="dropdow-menu" id="file-menu">
                    <ul>
                        <li><button type="button" onclick="document.getElementById('file-menu').classList.remove('visible');document.location.href = '/simple_editor';">Simple Editor</button></li>
                        <li><label class="custom-file-upload">
                            <input type="file" id="file-input" accept=".ds">
                            Open
                        </label></li>
                        <li><button type="button" onclick="document.getElementById('file-menu').classList.remove('visible');download();">Save</button></li>
                        <li><button type="button" onclick="document.getElementById('file-menu').classList.remove('visible');downloadJS();">Export as JS</button></li>
                    </ul>
                </div>
                <button class="header-button" onclick="document.getElementById('edit-menu').classList.toggle('visible');document.getElementById('file-menu').classList.remove('visible');">Edit</button>
                <div class="dropdow-menu" id="edit-menu">
                    <ul>
                        <li><button type="button" onclick="document.getElementById('edit-menu').classList.remove('visible');workspace.undo(false);">Undo</button></li>
                        <li><button type="button" onclick="document.getElementById('edit-menu').classList.remove('visible');workspace.undo(true);">Redo</button></li>
                        <li><button type="button" onclick="document.getElementById('edit-menu').classList.remove('visible');workspace.cleanUp();">Clean</button></li>
                    </ul>
                </div>
            </div>
            <div class="game-buttons">
                <input type="text" style="display: none;" id="name-input" name="name" value="Untitled" onchange="updateName()">
                <button class="game-button" id="play" onclick="play()"><img src="/assets/images/play.svg" alt="Play"></button>
            </div>
            <div>
                <button class="header-button" id="logout-button" style="display: none;" onclick="logout()">Logout</button>
                <button class="header-button login-button">Login</button>
            </div>
        </header>
        <section class="editor">
            <div id="blockly-div" class="editor-div"></div>
            <div id="hide-show-arrow"></div>
            <div class="console-div">
                <h2>Console</h2>
                <div id="console">
                    <div id="console-content">
                        /test>
                    </div>
                </div>
            </div>
            <div class="js-viewer-div">
                <h2>JavaScript</h2>
                <pre class="js-viewer line-numbers language-javascript"><code id="javascript-viewer"></code></pre>
            </div>
        </section>
        <div id="save-div" style="display: none;">
            <h3>To save and use your project please <a id="save-link" href="#">Login</a></h3>
            <button class="save-cancel-button" onclick="document.getElementById('save-div').style.display = 'none'">Cancel</button>
        </div>
        <div class="tutorial-background" id="tutorial1">
            <div class="tutorial-div">
                <h1>Create Discord Application</h1>
                <p>So that your application can connect to discord you must create an application on the <a href="https://discord.com/developers/applications">Discord developers pannel</a>.</p>
                <ol>
                    <li><a href="https://discord.com/developers/applications">Open Discord developers pannel</a> and click on "New Application"<br><img src="/assets/images/tutorial1.jpg" alt="New Application"></li>
                    <li>Choose a name and click on "Create"<br><img src="/assets/images/tutorial2.jpg" alt="Create"></li>
                    <li>Go to "Bot"<br><img src="/assets/images/tutorial3.jpg" alt="Bot"></li>
                    <li>Click on "Add Bot"<br><img src="/assets/images/tutorial4.jpg" alt="Add Bot"></li>
                    <li>Click on "Copy"<br><img src="/assets/images/tutorial5.jpg" alt="Copy"></li>
                    <li>And paste token in<br><img src="/assets/images/tutorial6.jpg" alt="Paste"></li>
                </ol>
                <button class="tutorial-close-button" onclick="document.getElementById('tutorial1').style.display = 'none';socket.emit('disableTutorial')">Close</button>
            </div>
        </div>
        <div class="tutorial-background" style="display: none;" id="tutorial2">
            <div class="tutorial-div">
                <h1>Invite Discord Bot</h1>
                <ol>
                    <li><a href="https://discord.com/developers/applications">Open Discord developers pannel</a> and click on your application</li>
                    <li>Go to "OAuth2"<br><img src="/assets/images/tutorial3.jpg" alt="Bot"></li>
                    <li>Select "bot"<br><img src="/assets/images/tutorial7.jpg" alt="scopes"></li>
                    <li>Select your bot permissions<br><img src="/assets/images/tutorial8.jpg" alt="permissions"></li>
                    <li>And click on "copy" after the url<br><img src="/assets/images/tutorial9.jpg" alt="Copy"></li>
                    <li>And past URL in a new tab</li>
                    <li>Now you can select your server and click on "Authorize"</li>
                </ol>
                <button class="tutorial-close-button" onclick="document.getElementById('tutorial2').style.display = 'none';socket.emit('disableTutorial')">Close</button>
            </div>
        </div>
        <script>
            var socket = io();
            Blockly.ScratchMsgs.setLocale("en");
            var workspace = Blockly.inject('blockly-div', {
              comments: true,
              disable: false,
              collapse: false,
              media: '/assets/images/scratch/',
              readOnly: false,
              rtl: false,
              scrollbars: true,
              toolbox: null,
              sounds: false,
              zoom: {
                controls: true,
                wheel: true,
                startScale: 0.675,
                maxScale: 4,
                minScale: 0.25,
                scaleSpeed: 1.1
              },
              colours: {
                fieldShadow: 'rgba(255, 255, 255, 0.3)',
                dragShadowOpacity: 0.6
              }
            });
            // Token and default blocks
            var defaultXML = '<xml xmlns="http://www.w3.org/1999/xhtml">' +
                '<block type="discord_token" id="f^}(kcWM:P]0Ki-7PH,4" deletable="false" movable="false" x="0" y="0">' +
                    '<field name="TEXT">token</field>' +
                '</block>' +
                '<block type="event_on" id="h0$AV2pq84-nP;=z49~P" x="0" y="96">' +
                    '<field name="ACTION">ready</field>' +
                    '<statement name="DO">' +
                        '<block type="sensing_log" id="^Hbrdm97i9]$/SJ@K:F8">' +
                            '<value name="TEXT">' +
                                '<shadow type="text" id="^jxJW~)+]xnB#+UtlQy*">' +
                                    '<field name="TEXT">Bot is online !</field>' +
                                '</shadow>' +
                            '</value>' +
                        '</block>' +
                    '</statement>' +
                '</block>' +
                '<block type="event_on" id=":Rd+teh^G@KsewvDIxwD" x="0" y="272">' +
                    '<field name="ACTION">message</field>' +
                    '<statement name="DO">' +
                        '<block type="control_if" id=")XmGcc6]At{uGvs%7`=s">' +
                            '<value name="CONDITION">' +
                                '<block type="operator_startswith" id="VoaA9kyY=yq4mqyBkoIr">' +
                                    '<value name="STRING1">' +
                                        '<shadow xmlns="" type="text" id="3aK~d81kQ8f}0U/PZXPL">' +
                                            '<field name="TEXT">hello world !</field>' +
                                        '</shadow>' +
                                        '<block type="message_content" id="ExL;Bf!|#wZ4J|QK;X0Q">' +
                                            '<value name="MESSAGE">' +
                                                '<block type="event_variables" id="q]{Tkhs;k?~pfEna%cUT">' +
                                                    '<field name="VARIABLE">message</field>' +
                                                '</block>' +
                                            '</value>' +
                                        '</block>' +
                                    '</value>' +
                                    '<value name="STRING2">' +
                                        '<shadow type="text" id="~HVIZDaP}7iuJ-J;pqoh">' +
                                            '<field name="TEXT">!ping</field>' +
                                        '</shadow>' +
                                    '</value>' +
                                '</block>' +
                            '</value>' +
                            '<statement name="SUBSTACK">' +
                                '<block type="message_reply" id="1t=K?nqBO{iQ#C3tz/e[">' +
                                    '<value name="TEXT">' +
                                        '<shadow type="text" id="2UOm-;]*c~@oa[hXn_mW">' +
                                            '<field name="TEXT">pong !</field>' +
                                        '</shadow>' +
                                    '</value>' +
                                    '<value name="MESSAGE">' +
                                        '<block type="event_variables" id="etv#Xb68BMy*uHMb/aMd">' +
                                            '<field name="VARIABLE">message</field>' +
                                        '</block>' +
                                    '</value>' +
                                '</block>' +
                            '</statement>' +
                        '</block>' +
                    '</statement>' +
                '</block>' +
            '</xml>';
            Blockly.Xml.domToWorkspace(Blockly.Xml.textToDom(defaultXML), workspace);
            workspace.addChangeListener(Blockly.Events.disableOrphans);
            function codeUpdate(event) {
                if (connected) {
                    var xml = Blockly.Xml.domToText(Blockly.Xml.workspaceToDom(workspace));
                    var code = start + Blockly.JavaScript.workspaceToCode(workspace) + end;
                    document.getElementById("javascript-viewer").innerHTML = code;
                    Prism.highlightElement(document.getElementById("javascript-viewer"));
                    socket.emit("updateCode", projectPath, code, projectName, xml);
                }
            }
            workspace.addChangeListener(codeUpdate);
        </script>
        <script src="/js/ui.js"></script>
    </body>
</html>
