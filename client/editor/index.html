<!DOCTYPE html>
<html lang="fr" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Discord Scratch</title>
        <link rel="shortcut icon" href="/assets/images/favicon.ico">
        <!-- <link rel="icon" href="/assets/images/discord-scratch-logo.png"> -->
        <meta name="description" content="A web site to make discord bots with scratch.">
        <meta name="author" content="ClÃ©ment Songis">
        <meta name="application-name" content="Discord Scratch">
        <meta name="theme-color" content="#cce1fc">
        <meta name="color-scheme" content="only light">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="index">
        <meta name="keywords" content="discord,scratch,bot">
        <link rel="stylesheet" href="/css/editor.css">
        <script src="https://kit.fontawesome.com/740353a2ba.js"></script>
        <script src="/js/blockly_compressed_vertical.js"></script>
        <script src="/js/blocks_compressed.js"></script>
        <script src="/js/blocks_compressed_vertical.js"></script>
        <script src="/js/scratch_msgs.js"></script>
        <script src="/js/javascript_compressed.js"></script>
        <script src="/js/blocks_javascript.js"></script>
        <script src="/socket.io/socket.io.js"></script>
    </head>
    <body>
        <header>
            <div>
                <button class="header-button logo-button" onclick="document.location.href = '/'"><img class="logo" src="/assets/images/logo.png" alt="Logo"></button>
                <button class="header-button" onclick="document.location.href = '#'">Editor</button>
                <button class="header-button" onclick="document.location.href = 'https://clementsongis.wordpress.com/'">Author WebSite</button>
                <button class="header-button" onclick="document.location.href = 'https://discord.gg/jwVzMKuNym'">Discord Serveur</button>
            </div>
            <div class="game-buttons">
                <input type="text" style="display: none;" id="name-input" name="name" value="Untitled" onchange="updateName()">
                <button class="game-button" id="play" onclick="play()"><img src="/assets/images/play.svg" alt="Play"></button>
            </div>
            <div>
                <button class="header-button" id="logout-button" style="display: none;" onclick="logout()">Logout</button>
                <button class="header-button login-button" onclick="document.location.href = 'https://discord.com/api/oauth2/authorize?client_id=797107487689932842&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Fredirect%2F&response_type=code&scope=identify%20email'">Login</button>
            </div>
        </header>
        <section class="editor">
            <div id="blockly-div" class="editor-div"></div>
            <div class="console-div">
                <h2>Console</h2>
                <div id="console">
                    <div id="console-content">
                        /test>
                    </div>
                </div>
            </div>
            <div class="js-viewer-div">
                <h2>JavaScript</h2>
                <textarea id="javascript-viewer" class="js-viewer" readonly></textarea>
            </div>
        </section>
        <div id="save-div" style="display: none;">
            <h3>To save and use your project please <a href="https://discord.com/api/oauth2/authorize?client_id=797107487689932842&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Fredirect%2F&response_type=code&scope=identify%20email">Login</a></h3>
            <button class="save-cancel-button" onclick="document.getElementById('save-div').style.display = 'none'">Cancel</button>
        </div>
        <div id="tutorial-background">
            <div id="tutorial-div">
                <h1>Create Discord Application</h1>
                <ol>
                    <li><a href="https://discord.com/developers/applications">Open Discord developers pannel</a> and click on "New Application"<br><img src="/assets/images/tutorial1.jpg" alt="New Application"></li>
                    <li>Choose a name and click on "Create"<br><img src="/assets/images/tutorial2.jpg" alt="Create"></li>
                    <li>Go to "Bot"<br><img src="/assets/images/tutorial3.jpg" alt="Bot"></li>
                    <li>Click on "Add Bot"<br><img src="/assets/images/tutorial4.jpg" alt="Add Bot"></li>
                    <li>Click on "Copy"<br><img src="/assets/images/tutorial5.jpg" alt="Copy"></li>
                    <li>And paste token in<br><img src="/assets/images/tutorial6.jpg" alt="Paste"></li>
                </ol>
                <button class="tutorial-close-button" onclick="document.getElementById('tutorial-background').style.display = 'none';socket.emit('disableTutorial')">Close</button>
            </div>
        </div>
        <script>
            var socket = io();
            Blockly.ScratchMsgs.setLocale("en");
            var workspace = Blockly.inject('blockly-div', {
              comments: true,
              disable: false,
              collapse: false,
              media: '/assets/images/scratch/',
              readOnly: false,
              rtl: false,
              scrollbars: true,
              toolbox: null,
              sounds: false,
              zoom: {
                controls: true,
                wheel: true,
                startScale: 0.675,
                maxScale: 4,
                minScale: 0.25,
                scaleSpeed: 1.1
              },
              colours: {
                fieldShadow: 'rgba(255, 255, 255, 0.3)',
                dragShadowOpacity: 0.6
              }
            });
            // Token
            var xml = '<xml><block type="discord_token" deletable="false" movable="false"><field name="TEXT">token</field></block></xml>';
            Blockly.Xml.domToWorkspace(Blockly.Xml.textToDom(xml), workspace);
            // Default Blocks
            Blockly.Xml.domToWorkspace(Blockly.Xml.textToDom('<xml><block type="event_on" id="h0$AV2pq84-nP;=z49~P" x="0" y="96"><value name="ACTION"><shadow type="event_on_menu" id="Z|4X@}#cKvPPf4kz~:l)"><field name="ACTION">ready</field></shadow></value><statement name="DO"><block type="sensing_log" id="^Hbrdm97i9]$/SJ@K:F8"><value name="TEXT"><shadow type="text" id="^jxJW~)+]xnB#+UtlQy*"><field name="TEXT">Bot is online !</field></shadow></value></block></statement></block><block type="event_on" id=":Rd+teh^G@KsewvDIxwD" x="0" y="272"><value name="ACTION"><shadow type="event_on_menu" id="fd_k+_6fGiEQfNAcXG/)"><field name="ACTION">message</field></shadow></value><statement name="DO"><block type="control_if" id=")XmGcc6]At{uGvs%7`=s"><value name="CONDITION"><block type="operator_startswith" id="VoaA9kyY=yq4mqyBkoIr"><value name="STRING1"><shadow type="text" id="3aK~d81kQ8f}0U/PZXPL"><field name="TEXT">hello world !</field></shadow><block type="event_on_message_content" id="7HW8[+$@#]gE{:7c;((n"></block></value><value name="STRING2"><shadow type="text" id="~HVIZDaP}7iuJ-J;pqoh"><field name="TEXT">!ping</field></shadow></value></block></value><statement name="SUBSTACK"><block type="event_reply" id="1t=K?nqBO{iQ#C3tz/e["><value name="TEXT"><shadow type="text" id="2UOm-;]*c~@oa[hXn_mW"><field name="TEXT">pong !</field></shadow></value></block></statement></block></statement></block></xml>'), workspace);

            workspace.addChangeListener(Blockly.Events.disableOrphans);
            function codeUpdate(event) {
                if (connected) {
                    var xml = Blockly.Xml.domToText(Blockly.Xml.workspaceToDom(workspace));
                    var code = start + Blockly.JavaScript.workspaceToCode(workspace) + end;
                    document.getElementById("javascript-viewer").value = code;
                    socket.emit("updateCode", projectPath, code, projectName, xml);
                }
            }
            workspace.addChangeListener(codeUpdate);
            // Export Code
            // var xml = Blockly.Xml.workspaceToDom(workspace);
            // var xml_text = Blockly.Xml.domToText(xml);
            // Inport Code
            // var xml = Blockly.Xml.textToDom(xml_text);
            // Blockly.Xml.domToWorkspace(xml, workspace);
        </script>
        <script src="/js/ui.js"></script>
    </body>
</html>
